@model CartViewModel
@{
	ViewData["Title"] = "Cart";
}
<div class="container mt-5">
	<h1 class="mb-4">Cart</h1>

	@if (Model.ItemList.Count == 0)
	{
		<div class="alert alert-info" role="alert">
			Your cart is empty. Start adding items to your cart!
		</div>
	}
	else
	{
		<div class="list-group">
			@foreach (var item in Model.ItemList)
			{
				<div class="list-group-item d-flex justify-content-between align-items-center">
					<div>
						<h5>@item.DishName</h5>
						<div class="d-flex align-items-center">
							<span class="me-3">Quantity: @item.Quantity</span>
							<button class="btn btn-outline-secondary btn-sm me-2"
									onclick="updateQuantity(@item.Id, false)">
								-
							</button>
							<button class="btn btn-outline-secondary btn-sm"
									onclick="updateQuantity(@item.Id, true)">
								+
							</button>
						</div>
					</div>
					<div>
						<span class="fw-bold">Price: @Html.DisplayFor(modelItem => item.Price)</span><br />
					</div>
				</div>
			}
		</div>

		<div class="mt-4 d-flex justify-content-between">
			<button class="btn btn-danger" onclick="clearCart()">Clear Cart</button>
			<span class="fw-bold fs-5">Total: @Model.ItemList.Sum(item => item.Quantity * item.Price).ToString("C")</span>
		</div>
	}
</div>

@section Scripts {
	<script>
		function updateQuantity(id, increase) {
			$.ajax({
				url: '@Url.Action("UpdateQuantity", "Cart")',
				type: 'POST',
				data: { dishId: id, isIncrease: increase },
				success: function (response) {
					if (response.success) {
						location.reload();
					} else {
						// Handle unsuccess
					}
				},
				error: function (jqXHR, textStatus, errorThrown) { // Log any errors
					console.error('Upload failed:', textStatus, errorThrown);
				}
			});
		}

		function clearCart() {
			$.ajax({
				url: '@Url.Action("ClearCart", "Cart")',
				type: 'POST',
				success: function (response) {
					if (response.success) {
						location.reload();
					} else {
						// Handle unsuccess
					}
				},
				error: function (jqXHR, textStatus, errorThrown) { // Log any errors
					console.error('Upload failed:', textStatus, errorThrown);
				}
			});
		}
	</script>
}