@model MakeReservationViewModel

@{
	ViewData["Title"] = "Reservation";
}

<div class="container mt-5">
	<h1 class="mb-4">Cart</h1>

	@if (Model.Cart.ItemList.Count == 0)
	{
		<div class="alert alert-info" role="alert">
			Your cart is empty. Start adding items to your cart!
		</div>
	}
	else
	{
		<div class="list-group">
			@foreach (var item in Model.Cart.ItemList)
			{
				<div class="list-group-item d-flex justify-content-between align-items-center">
					<div>
						<h5>@item.DishName</h5>
						<div class="d-flex align-items-center">
							<span class="me-3">Quantity: @item.Quantity</span>
							<button class="btn btn-outline-secondary btn-sm me-2"
									onclick="updateQuantity(@item.Id, false)">
								-
							</button>
							<button class="btn btn-outline-secondary btn-sm"
									onclick="updateQuantity(@item.Id, true)">
								+
							</button>
							<button class="btn btn-outline-danger btn-sm ms-2"
									onclick="removeItem(@item.Id)">
								Remove
							</button>
						</div>
					</div>
					<div>
						<span class="fw-bold">Price: @Html.DisplayFor(modelItem => item.Price)</span><br />
					</div>
				</div>
			}
		</div>

		<div class="mt-4 d-flex justify-content-between">
			<button class="btn btn-danger" onclick="clearCart()">Clear Cart</button>
			<span class="fw-bold fs-5">Total: @Model.Cart.ItemList.Sum(item => item.Quantity * item.Price).ToString("C")</span>
		</div>
	}

	<hr class="py-4" />

	<h1 class="mb-4">Reservation</h1>

	<partial name="Partials/_AlertSuccess" model='TempData["Success"]' />
	<partial name="Partials/_AlertDanger" model='TempData["Error"]' />

	<form method="post" asp-action="MakeReservation" asp-controller="Reservation">
		<div class="form-floating mb-3">
			<input asp-for="PartySize" class="form-control" />
			<label asp-for="PartySize"></label>
			<span asp-validation-for="PartySize" class="text-danger"></span>
		</div>

		<div class="form-floating mb-3">
			<input asp-for="ResDate" type="date" class="form-control" />
			<label asp-for="ResDate"></label>
			<span asp-validation-for="ResDate" class="text-danger"></span>
		</div>

		<div class="form-floating mb-3">
			<input asp-for="ResTime" type="time" class="form-control" />
			<label asp-for="ResTime"></label>
			<span asp-validation-for="ResTime" class="text-danger"></span>
		</div>

		<div class="form-floating mb-3">
			<textarea asp-for="Notes" class="form-control"></textarea>
			<label asp-for="Notes"></label>
			<span asp-validation-for="Notes" class="text-danger"></span>
		</div>

		<button type="submit" class="btn btn-primary">Reserve</button>
	</form>
</div>

@section Scripts {
	<script>
		function updateQuantity(id, increase) {
			$.ajax({
				url: '@Url.Action("UpdateQuantity", "Cart")',
				type: 'POST',
				data: { dishId: id, isIncrease: increase },
				success: function (response) {
					if (response.success) {
						location.reload();
					} else {
						// Handle unsuccess
					}
				},
				error: function (jqXHR, textStatus, errorThrown) { // Log any errors
					console.error('Upload failed:', textStatus, errorThrown);
				}
			});
		}

		function clearCart() {
			$.ajax({
				url: '@Url.Action("ClearCart", "Cart")',
				type: 'POST',
				success: function (response) {
					if (response.success) {
						location.reload();
					} else {
						// Handle unsuccess
					}
				},
				error: function (jqXHR, textStatus, errorThrown) { // Log any errors
					console.error('Upload failed:', textStatus, errorThrown);
				}
			});
		}

		function removeItem(id) {
			$.ajax({
				url: '@Url.Action("RemoveItem", "Cart")',
				type: 'POST',
				data: { dishId: id },
				success: function (response) {
					if (response.success) {
						location.reload();
					} else {
						// Handle unsuccess
					}
				},
				error: function (jqXHR, textStatus, errorThrown) { // Log any errors
					console.error('Upload failed:', textStatus, errorThrown);
				}
			});
		}
	</script>
}